{% extends 'accounts/index.html' %}

{% block content %}
<div style="margin-left: 40%;" class="container">
    <h1>Title: {{ book.title }}</h1>

    <p><strong>Author:</strong> <a href="">{{ book.author }}</a></p> <!-- author detail link not yet defined -->
    <p><strong>Summary:</strong> {{ book.summary }}</p>
    <p><strong>ISBN:</strong> {{ book.isbn }}</p>
    <p><strong>Language:</strong> {{ book.language }}</p>
    <p><strong>Genre:</strong> {{ book.genre.all|join:", " }}</p>

    <div style="margin-left:20px;margin-top:20px">
      <h4>Copies</h4>

      {% for copy in book.bookinstance_set.all %}
      <hr>

      <p
        class="{% if copy.status == 'a' %}text-success{% elif copy.status == 'm' %}text-danger{% else %}text-warning{% endif %}">
        {{ copy.get_status_display }}
      </p>
      {% if copy.status != 'a' %}
      <p><strong>Due to be returned:</strong> <span class="text-danger">{{ copy.due_back }}</span></p>
      {% endif %}
      <p><strong>Imprint:</strong> {{ copy.imprint }}</p>
      <p class="text-muted"><strong>Id:</strong> {{ copy.id }}</p>
      <button class="btn btn-primary issue" type="button" id="id_{{ copy.id }}">Borrow</button>
{% endfor %}

</div>
</div>

<script>
  $('.issue').click(function(){
    alert("hello")
    let result = confirm('Are you want to issue This book?')
    if (result) {
      id = this.id.split('_').pop()
      $.ajax({
        url: "{% url 'book_managment:borrow' %}",
        dataType: "json",
        data: { 'id': id },
        success: function (data) {
          if (data.success == true) {
            alert(data.msg)
          }
          else {
            alert(data.success)
          }
        },
      });
    } else {

    }
  });
</script>
{% endblock content %}