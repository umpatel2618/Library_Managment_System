{% extends 'accounts/index.html' %}

{% block content %}
<div style="margin-left: 25%;" class="container">
  <h1>Title: {{ book.title }}</h1>

  <p><strong>Author : </strong> {{ book.author }}</p>
  <!-- author detail link not yet defined -->
  <p><strong>Summary:</strong> {{ book.summary }}</p>
  <p><strong>ISBN :</strong> {{ book.isbn }}</p>
  <p><strong>Genre :</strong> {{ book.genre.all|join:", " }}</p>
  <div style="margin-left:20px;margin-top:20px">
    <h4>Copies</h4>

    {% for copy in book.bookinstance_set.all %}
    <hr>


    <p
      class="{% if copy.status == 'a' %}text-success{% elif copy.status == 'o' %}text-danger{% else %}text-warning{% endif %}">
      {{ copy.get_status_display }}
    </p>
    {% if copy.status != 'a' %}
    <p><strong>Due to be returned:</strong> <span class="text-danger">{{ copy.due_back }}</span></p>
    {% endif %}
    <p><strong>Imprint:</strong> {{ copy.imprint }}</p>
    <p class="text-muted"><strong>Id:</strong> {{ copy.id }}</p>
    {% if user.is_staff %}
        <a class="badge badge-success p-2" href="{% url 'book_managment:bookinstance_update' pk=copy.id %}"><i class="fa fa-cog fa-lg"></i></a>
        <a class="badge badge-danger p-2 delete" href="{% url 'book_managment:bookinstance_delete' pk=copy.id %}"><i class="fas fa-trash "></i></a>
    {% elif user.is_authenticated %}
        {% if copy.status == 'o' %}
        <h5 class="text-danger"> This Book Is Already on loan But you can request to join waiting list for this book.</h5>
        <button class="btn btn-primary issue" type="button" id="id_{{ copy.id }}">Borrow Request</button>
        <a class="btn btn-success " href="{% url 'book_managment:waiting_list' %}">See Waiting List</a>
        {% elif copy.status == 'm' %}
        <h5 class="text-danger"> This Book Is Under Maintenance , Please wait untill it's become available.</h5>
        {% elif copy.status == 'r' %}
        <h5 class="text-warning"> This Book Is Reserved for now, Please wait untill it's become available.</h5>
        {% endif %}
    {% else  %}
    {% if copy.status == 'o' %}
    <h5 class="text-danger"> This Book Is Already on loan But you can request to join waiting list for this book.</h5>
    <a class="btn btn-primary " href="{% url 'accounts:login' %}">Borrow Request</a>
    <a class="btn btn-success" href="{% url 'book_managment:waiting_list' %}">See Waiting List</a>

    {% elif copy.status == 'm' %}
    <h5 class="text-danger"> This Book Is Under Maintenance , Please wait untill it's become available.</h5>
    {% elif copy.status == 'r' %}
    <h5 class="text-warning"> This Book Is Reserved for now, Please wait untill it's become available.</h5>
    {% endif %}
    {% endif %}
  {% endfor %}
 </div>
</div>
<script>
  $('.issue').click(function () {
    alert("hello")
    let result = confirm('Are you want to issue This book?')
    if (result) {
      id = this.id.split('_').pop()
      $.ajax({
        url: "{% url 'book_managment:borrow' %}",
        dataType: "json",
        data: { 'id': id },
        success: function (data) {
          if (data.success == true) {
            alert(data.msg)
          }
          else {
            alert(data.success)
          }
        },
      });
    } else {

    }
  });
</script>
{% endblock content %}